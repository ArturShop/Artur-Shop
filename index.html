<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Artur Shop</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@500;600&display=swap" rel="stylesheet">

<style>
body{
  margin:0;
  font-family:'Poppins', Arial, sans-serif;
  background:#f2f2f2;
}

/* HEADER */
.header{
  background:#000;
  color:#fff;
  padding:15px 25px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}

.logo{
  display:flex;
  align-items:center;
  gap:12px;
}

.logo img{
  height:50px;
}

.logo span{
  font-size:22px;
  letter-spacing:3px;
  font-weight:600;
}

nav a{
  color:#fff;
  text-decoration:none;
  margin-left:20px;
  font-weight:500;
}

nav a:hover{
  text-decoration:underline;
}

/* CAT√ÅLOGO */
#catalogo{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(260px,1fr));
  gap:25px;
  padding:30px;
}

.producto{
  background:#fff;
  padding:18px;
  border-radius:12px;
  text-align:center;
  box-shadow:0 8px 20px rgba(0,0,0,0.08);
  transition:transform .2s, box-shadow .2s;
}

.producto:hover{
  transform:translateY(-5px);
  box-shadow:0 12px 25px rgba(0,0,0,0.15);
}

.producto img{
  width:100%;
  height:220px;
  object-fit:cover;
  border-radius:10px;
}

.producto h3{
  margin:12px 0 6px;
}

.producto p{
  margin:5px 0;
  font-weight:600;
}

/* FORM */
select,input{
  width:100%;
  padding:8px;
  margin-top:8px;
  border-radius:6px;
  border:1px solid #ccc;
}

button{
  width:100%;
  background:#000;
  color:#fff;
  border:none;
  padding:12px;
  margin-top:12px;
  border-radius:8px;
  cursor:pointer;
  font-size:14px;
}

button:hover:not(:disabled){
  background:#222;
}

button:disabled{
  background:#999;
  cursor:not-allowed;
}

/* CARRITO */
#carrito{
  position:fixed;
  right:20px;
  bottom:20px;
  width:320px;
  background:#fff;
  padding:18px;
  border-radius:15px;
  box-shadow:0 10px 25px rgba(0,0,0,0.2);
}

#carrito h3{
  margin-top:0;
}

#lista li{
  font-size:14px;
  margin-bottom:6px;
}
</style>
</head>

<body>

<header class="header">
  <div class="logo">
    <img src="images/logo.png" alt="Artur Shop">
    <span>ARTUR SHOP</span>
  </div>

  <nav>
    <a target="_blank" href="catalogo.html">Cat√°logo</a>
    <a target="_blank" href="https://wa.me/525548438403?text=Quisiera%20una%20atenci√≥n%20personalizada%20y%20una%20cotizaci√≥n">Contacto</a>
  </nav>
</header>

<div id="catalogo"></div>

<div id="carrito">
  <h3>üõí Carrito</h3>
  <ul id="lista"></ul>
  <p><strong>Total:</strong> $<span id="total">0</span></p>
  <button onclick="enviar()">Finalizar pedido</button>
</div>

<script>
const sheetURL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQCWkxVJTImAd3wDy4Ls_ErsI-RbFyU3YZmZVthPrb2pIO8w41wOWqKMeZ-KJfNPLnDi5pafXFOfd65/pub?gid=0&single=true&output=csv";
let data = {};
let carrito = [];

fetch(sheetURL)
.then(r=>r.text())
.then(csv=>{
  csv.split("\n").slice(1).forEach(row=>{
    let cols = row.match(/(".*?"|[^",]+)(?=,|$)/g);
    if(!cols) return;

    let [nombre,precio,img,talla,color,stock] = cols.map(c=>c.replace(/"/g,""));

    precio = Number(precio.replace(/[^0-9.]/g,""));
    stock = Number(stock);

    if(!data[nombre]){
      data[nombre]={precio,img,items:[]};
    }

    data[nombre].items.push({talla,color,stock});
  });

  renderProductos();
});

function renderProductos(){
  const cont = document.getElementById("catalogo");
  cont.innerHTML="";

  Object.keys(data).forEach(nombre=>{
    const p = data[nombre];
    const tallas = [...new Set(p.items.map(i=>i.talla))];

    cont.innerHTML+=`
    <div class="producto">
      <img src="${p.img}">
      <h3>${nombre}</h3>
      <p>$${p.precio}</p>

      <select onchange="cargarColores(this,'${nombre}')">
        <option value="">Selecciona talla</option>
        ${tallas.map(t=>`<option>${t}</option>`).join("")}
      </select>

      <select disabled></select>
      <input type="number" min="1" value="1" disabled>
      <button disabled onclick="add(this,'${nombre}')">A√±adir</button>
    </div>`;
  });
}

function cargarColores(sel,nombre){
  const card = sel.parentElement;
  const colorSel = card.querySelectorAll("select")[1];
  const btn = card.querySelector("button");
  const qty = card.querySelector("input");

  colorSel.innerHTML='<option value="">Selecciona color</option>';
  qty.disabled=true;
  btn.disabled=true;

  data[nombre].items
    .filter(i=>i.talla===sel.value && i.stock>0)
    .forEach(i=>{
      colorSel.innerHTML+=`<option data-stock="${i.stock}">${i.color}</option>`;
    });

  colorSel.disabled=false;

  colorSel.onchange=()=>{
    const opt = colorSel.selectedOptions[0];
    if(!opt)return;
    const stock = Number(opt.dataset.stock);
    qty.max=stock;
    qty.value=1;
    qty.disabled=false;
    btn.disabled=false;
  }
}

function add(btn,nombre){
  const card = btn.parentElement;
  const talla = card.querySelectorAll("select")[0].value;
  const color = card.querySelectorAll("select")[1].value;
  const qty = Number(card.querySelector("input").value);

  carrito.push({nombre,talla,color,qty,precio:data[nombre].precio});
  renderCarrito();
}

function renderCarrito(){
  let total=0;
  document.getElementById("lista").innerHTML=carrito.map((p,i)=>{
    total+=p.precio*p.qty;
    return `<li>${p.nombre} ${p.talla} ${p.color} x${p.qty} <button onclick="del(${i})">‚ùå</button></li>`;
  }).join("");
  document.getElementById("total").textContent=total;
}

function del(i){
  carrito.splice(i,1);
  renderCarrito();
}

function enviar(){
  let msg="Pedido:%0A";
  carrito.forEach(p=>{
    msg+=`${p.nombre} ${p.talla} ${p.color} x${p.qty}%0A`;
  });
  window.open("https://wa.me/525548438403?text="+msg,"_blank");
}
</script>

</body>
</html>
