<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Artur Shop</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@500;600&display=swap" rel="stylesheet">

<style>
body{
  margin:0;
  font-family:'Poppins', Arial, sans-serif;
  background:#f2f2f2;
}

/* HEADER */
.header{
  background:#000;
  color:#fff;
  padding:15px 25px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}

.logo{
  display:flex;
  align-items:center;
  gap:12px;
}

.logo img{height:50px}
.logo span{font-size:22px;letter-spacing:3px;font-weight:600}

nav a{
  color:#fff;
  text-decoration:none;
  margin-left:20px;
}

/* CAT√ÅLOGO */
#catalogo{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(260px,1fr));
  gap:25px;
  padding:30px;
}

.producto{
  background:#fff;
  padding:18px;
  border-radius:12px;
  text-align:center;
  box-shadow:0 8px 20px rgba(0,0,0,.08);
}

.producto img{
  width:100%;
  height:220px;
  object-fit:cover;
  border-radius:10px;
}

select,input,button{
  width:100%;
  padding:8px;
  margin-top:8px;
  border-radius:6px;
}

button{
  background:#000;
  color:#fff;
  border:none;
  cursor:pointer;
}

button:disabled{background:#999}

.sin-stock{
  color:red;
  font-weight:600;
}

/* CARRITO */
#carrito{
  position:fixed;
  right:20px;
  bottom:20px;
  width:320px;
  background:#fff;
  padding:18px;
  border-radius:15px;
  box-shadow:0 10px 25px rgba(0,0,0,.2);
}

#lista li{font-size:14px;margin-bottom:5px}
</style>
</head>

<body>

<header class="header">
  <div class="logo">
    <img src="images/logo.png">
    <span>ARTUR SHOP</span>
  </div>
  <nav>
    <a href="catalogo.html" target="_blank">Cat√°logo</a>
    <a href="https://wa.me/525548438403" target="_blank">Contacto</a>
  </nav>
</header>

<div id="catalogo"></div>

<div id="carrito">
  <h3>üõí Carrito</h3>
  <ul id="lista"></ul>

  <p><strong>Total:</strong> $<span id="total">0</span></p>

  <!-- FORMA DE ENTREGA -->
  <select id="entrega">
    <option value="">Selecciona forma de entrega</option>
    <option>Env√≠o a domicilio</option>
    <option>Entrega en punto medio</option>
    <option>Entrega en estaci√≥n L√≠nea 2</option>
  </select>

  <button onclick="enviar()">Finalizar pedido</button>
</div>

<script>
const sheetURL="https://docs.google.com/spreadsheets/d/e/2PACX-1vQCWkxVJTImAd3wDy4Ls_ErsI-RbFyU3YZmZVthPrb2pIO8w41wOWqKMeZ-KJfNPLnDi5pafXFOfd65/pub?gid=0&single=true&output=csv";
let data={}, carrito=JSON.parse(localStorage.getItem("carritoArturShop"))||[];

fetch(sheetURL).then(r=>r.text()).then(csv=>{
  csv.split("\n").slice(1).forEach(row=>{
    const c=row.match(/(".*?"|[^",]+)(?=,|$)/g);
    if(!c)return;
    let [n,p,i,t,col,s]=c.map(x=>x.replace(/"/g,""));
    p=Number(p.replace(/[^0-9.]/g,""));
    s=Number(s);
    if(!data[n]) data[n]={precio:p,img:i,items:[]};
    data[n].items.push({talla:t,color:col,stock:s});
  });
  renderProductos();
  renderCarrito();
});

function renderProductos(){
  const cont=document.getElementById("catalogo");
  cont.innerHTML="";
  Object.keys(data).forEach(n=>{
    const p=data[n];
    const tallas=[...new Set(p.items.map(i=>i.talla))];
    cont.innerHTML+=`
    <div class="producto">
      <img src="${p.img}">
      <h3>${n}</h3>
      <p>$${p.precio}</p>
      <select onchange="cargarColores(this,'${n}')">
        <option value="">Selecciona talla</option>
        ${tallas.map(t=>`<option>${t}</option>`).join("")}
      </select>
      <select disabled></select>
      <input type="number" min="1" value="1" disabled>
      <p class="sin-stock" style="display:none">Sin stock disponible</p>
      <button disabled onclick="add(this,'${n}')">A√±adir</button>
    </div>`;
  });
}

function cargarColores(sel,n){
  const c=sel.parentElement;
  const color=c.querySelectorAll("select")[1];
  const qty=c.querySelector("input");
  const btn=c.querySelector("button");
  const aviso=c.querySelector(".sin-stock");
  aviso.style.display="none";
  color.innerHTML="<option>Selecciona color</option>";
  qty.disabled=btn.disabled=true;
  const disp=data[n].items.filter(i=>i.talla===sel.value && i.stock>0);
  if(!disp.length){aviso.style.display="block";color.disabled=true;return;}
  disp.forEach(i=>color.innerHTML+=`<option data-stock="${i.stock}">${i.color}</option>`);
  color.disabled=false;
  color.onchange=()=>{
    qty.max=color.selectedOptions[0].dataset.stock;
    qty.value=1;
    qty.disabled=btn.disabled=false;
  }
}

function add(btn,n){
  const c=btn.parentElement;
  carrito.push({
    nombre:n,
    talla:c.querySelectorAll("select")[0].value,
    color:c.querySelectorAll("select")[1].value,
    qty:Number(c.querySelector("input").value),
    precio:data[n].precio
  });
  renderCarrito();
}

function renderCarrito(){
  let t=0;
  document.getElementById("lista").innerHTML=carrito.map((p,i)=>{
    t+=p.precio*p.qty;
    return `<li>${p.nombre} ${p.talla} ${p.color} x${p.qty} <button onclick="del(${i})">‚ùå</button></li>`;
  }).join("");
  document.getElementById("total").textContent=t;
  localStorage.setItem("carritoArturShop",JSON.stringify(carrito));
}

function del(i){carrito.splice(i,1);renderCarrito();}

function enviar(){
  const entrega=document.getElementById("entrega").value;
  if(!entrega){alert("Selecciona la forma de entrega");return;}

  let total=document.getElementById("total").textContent;
  let msg="üõí *Pedido Artur Shop*%0A";
  carrito.forEach(p=>{
    msg+=`‚Ä¢ ${p.nombre} | ${p.talla} | ${p.color} x${p.qty}%0A`;
  });
  msg+=`%0A*Forma de entrega:* ${entrega}%0A`;
  msg+=`*Total:* $${total}`;
  window.open("https://wa.me/525548438403?text="+msg,"_blank");
}
</script>

</body>
</html>
