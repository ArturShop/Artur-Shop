<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Artur Shop</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{margin:0;font-family:Arial;background:#f5f5f5}
header{background:#000;color:#fff;padding:15px;display:flex;justify-content:space-between}
header a{color:#fff;margin-left:15px;text-decoration:none;font-weight:bold}
#catalogo{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:20px;padding:20px}
.producto{background:#fff;padding:15px;border-radius:10px;text-align:center}
.producto img{width:100%;height:220px;object-fit:cover;border-radius:10px}
select,input{width:90%;padding:6px;margin-top:8px}
button{background:#000;color:#fff;border:none;padding:10px;margin-top:10px;border-radius:5px;cursor:pointer}
button:disabled{opacity:.5}
#carrito{position:fixed;right:20px;bottom:20px;width:320px;background:#fff;padding:15px;border-radius:10px}
</style>
</head>

<body>

<header>
<h2>Artur Shop</h2>
<nav>
<a target="_blank" href="catalogo.html">Cat√°logo</a>
<a target="_blank" href="https://wa.me/525548438403?text=Quisiera%20una%20atenci√≥n%20personalizada%20y%20una%20cotizaci√≥n">Contacto</a>
</nav>
</header>

<div id="catalogo"></div>

<div id="carrito">
<h3>üõí Carrito</h3>
<ul id="lista"></ul>
<p>Total: $<span id="total">0</span></p>
<button onclick="enviar()">Finalizar pedido</button>
</div>

<script>
const sheetURL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQCWkxVJTImAd3wDy4Ls_ErsI-RbFyU3YZmZVthPrb2pIO8w41wOWqKMeZ-KJfNPLnDi5pafXFOfd65/pub?gid=0&single=true&output=csv";
let data = {};
let carrito = [];

fetch(sheetURL)
.then(r=>r.text())
.then(csv=>{
  csv.split("\n").slice(1).forEach(row=>{
    let [nombre,precio,img,talla,color,stock] = row.split(",");
    precio = Number(precio.replace(/[^0-9.]/g,""));
    stock = Number(stock);

    if(!data[nombre]){
      data[nombre]={precio,img,items:[]};
    }
    data[nombre].items.push({talla,color,stock});
  });

  renderProductos();
});

function renderProductos(){
  const cont = document.getElementById("catalogo");
  cont.innerHTML="";

  Object.keys(data).forEach(nombre=>{
    const p = data[nombre];
    const tallas = [...new Set(p.items.map(i=>i.talla))];

    cont.innerHTML+=`
    <div class="producto">
      <img src="${p.img}">
      <h3>${nombre}</h3>
      <p>$${p.precio}</p>
      <select onchange="cargarColores(this,'${nombre}')">
        <option value="">Selecciona talla</option>
        ${tallas.map(t=>`<option>${t}</option>`).join("")}
      </select>
      <select disabled></select>
      <input type="number" min="1" value="1" disabled>
      <button disabled onclick="add(this,'${nombre}')">A√±adir</button>
    </div>`;
  });
}

function cargarColores(sel,nombre){
  const card = sel.parentElement;
  const colorSel = card.querySelectorAll("select")[1];
  const btn = card.querySelector("button");
  const qty = card.querySelector("input");

  colorSel.innerHTML='<option value="">Selecciona color</option>';
  qty.disabled=true;
  btn.disabled=true;

  data[nombre].items
    .filter(i=>i.talla===sel.value && i.stock>0)
    .forEach(i=>{
      colorSel.innerHTML+=`<option data-stock="${i.stock}">${i.color}</option>`;
    });

  colorSel.disabled=false;

  colorSel.onchange=()=>{
    const opt = colorSel.selectedOptions[0];
    if(!opt)return;
    const stock = Number(opt.dataset.stock);
    qty.max=stock;
    qty.value=1;
    qty.disabled=false;
    btn.disabled=false;
  }
}

function add(btn,nombre){
  const card = btn.parentElement;
  const talla = card.querySelectorAll("select")[0].value;
  const color = card.querySelectorAll("select")[1].value;
  const qty = Number(card.querySelector("input").value);
  carrito.push({nombre,talla,color,qty,precio:data[nombre].precio});
  renderCarrito();
}

function renderCarrito(){
  let total=0;
  document.getElementById("lista").innerHTML=carrito.map((p,i)=>{
    total+=p.precio*p.qty;
    return `<li>${p.nombre} ${p.talla} ${p.color} x${p.qty} <button onclick="del(${i})">‚ùå</button></li>`;
  }).join("");
  document.getElementById("total").textContent=total;
}

function del(i){
  carrito.splice(i,1);
  renderCarrito();
}

function enviar(){
  let msg="Pedido:%0A";
  carrito.forEach(p=>{
    msg+=`${p.nombre} ${p.talla} ${p.color} x${p.qty}%0A`;
  });
  window.open("https://wa.me/525548438403?text="+msg,"_blank");
}
</script>

</body>
</html>
