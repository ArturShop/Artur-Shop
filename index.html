<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Pargam Shoes</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{margin:0;font-family:Arial;background:#98DB3D}
header{background:#000;color:#fff;padding:15px;display:flex;justify-content:space-between;align-items:center}
header img{height:45px}
header a{color:#fff;margin-left:15px;text-decoration:none;font-weight:bold}

#catalogo{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(280px,1fr));
  gap:20px;
  padding:20px
}
.producto{
  background:#fff;
  padding:15px;
  border-radius:10px;
  text-align:center
}
.producto img{
  width:100%;
  height:220px;
  object-fit:cover;
  border-radius:10px
}
select,input{
  width:90%;
  padding:7px;
  margin-top:8px
}
button{
  background:#000;
  color:#fff;
  border:none;
  padding:10px;
  margin-top:10px;
  border-radius:5px;
  cursor:pointer
}
button:disabled{opacity:.5;cursor:not-allowed}

#carrito{
  position:fixed;
  right:20px;
  bottom:20px;
  width:330px;
  background:#fff;
  padding:15px;
  border-radius:10px;
  box-shadow:0 0 10px rgba(0,0,0,.2)
}
#carrito ul{padding-left:18px}
#carrito li{margin-bottom:6px}
</style>
</head>

<body>

<header>
  <img src="images/logo.png">
  <nav>
    <a target="_blank" href="catalogo.html">Cat√°logo</a>
    <a target="_blank" href="https://wa.me/525548438403?text=Quisiera%20una%20atenci√≥n%20personalizada%20y%20una%20cotizaci√≥n">Contacto</a>
  </nav>
</header>

<div id="catalogo"></div>

<div id="carrito">
  <h3>üõí Carrito</h3>
  <ul id="lista"></ul>
  <p><b>Total: $<span id="total">0</span></b></p>

  <select id="entrega">
    <option value="">Selecciona forma de entrega</option>
    <option>Env√≠o a domicilio</option>
    <option>Entrega personal</option>
    <option>Recoger en tienda</option>
  </select>

  <button onclick="finalizar()">Finalizar compra</button>
</div>

<script>
const sheetURL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQCWkxVJTImAd3wDy4Ls_ErsI-RbFyU3YZmZVthPrb2pIO8w41wOWqKMeZ-KJfNPLnDi5pafXFOfd65/pub?gid=0&single=true&output=csv";

let productos = {};
let carrito = [];

fetch(sheetURL)
.then(res=>res.text())
.then(csv=>{
  const filas = csv.split("\n").slice(1);

  filas.forEach(f=>{
    let [nombre,precio,img,talla,color,stock] = f.split(",");
    precio = parseFloat(precio);
    stock = parseInt(stock);

    if(!productos[nombre]){
      productos[nombre] = {precio,img,variantes:[]};
    }

    productos[nombre].variantes.push({talla,color,stock});
  });

  renderCatalogo();
});

function renderCatalogo(){
  const cont = document.getElementById("catalogo");
  cont.innerHTML="";

  Object.keys(productos).forEach(nombre=>{
    const p = productos[nombre];
    const tallas = [...new Set(p.variantes.map(v=>v.talla))];

    cont.innerHTML+=`
    <div class="producto">
      <img src="${p.img}">
      <h3>${nombre}</h3>
      <p><b>$${p.precio}</b></p>

      <select onchange="cargarColores(this,'${nombre}')">
        <option value="">Selecciona talla</option>
        ${tallas.map(t=>`<option>${t}</option>`).join("")}
      </select>

      <select disabled></select>

      <input type="number" min="1" value="1" disabled>

      <button disabled onclick="agregar(this,'${nombre}')">Agregar</button>
    </div>`;
  });
}

function cargarColores(sel,nombre){
  const card = sel.parentElement;
  const colorSel = card.querySelectorAll("select")[1];
  const qty = card.querySelector("input");
  const btn = card.querySelector("button");

  colorSel.innerHTML='<option value="">Selecciona color</option>';
  qty.disabled=true;
  btn.disabled=true;

  productos[nombre].variantes
    .filter(v=>v.talla===sel.value && v.stock>0)
    .forEach(v=>{
      colorSel.innerHTML+=`<option data-stock="${v.stock}">${v.color}</option>`;
    });

  colorSel.disabled=false;

  colorSel.onchange=()=>{
    const opt = colorSel.selectedOptions[0];
    if(!opt)return;
    qty.max = opt.dataset.stock;
    qty.value = 1;
    qty.disabled=false;
    btn.disabled=false;
  }
}

function agregar(btn,nombre){
  const card = btn.parentElement;
  const talla = card.querySelectorAll("select")[0].value;
  const color = card.querySelectorAll("select")[1].value;
  const qty = parseInt(card.querySelector("input").value);

  carrito.push({
    nombre,
    talla,
    color,
    qty,
    precio: productos[nombre].precio
  });

  renderCarrito();
}

function renderCarrito(){
  let total=0;
  const lista = document.getElementById("lista");
  lista.innerHTML="";

  carrito.forEach((p,i)=>{
    total += p.precio * p.qty;
    lista.innerHTML+=`
      <li>
        ${p.nombre} ${p.talla} ${p.color} x${p.qty}
        <button onclick="eliminar(${i})">‚ùå</button>
      </li>`;
  });

  document.getElementById("total").textContent = total.toFixed(2);
}

function eliminar(i){
  carrito.splice(i,1);
  renderCarrito();
}

function finalizar(){
  if(carrito.length===0){
    alert("El carrito est√° vac√≠o");
    return;
  }

  const entrega = document.getElementById("entrega").value;
  if(!entrega){
    alert("Selecciona forma de entrega");
    return;
  }

  let msg="Pedido:%0A";
  carrito.forEach(p=>{
    msg+=`${p.nombre} ${p.talla} ${p.color} x${p.qty}%0A`;
  });

  msg+=`%0ATotal: $${document.getElementById("total").textContent}`;
  msg+=`%0AEntrega: ${entrega}`;

  window.open("https://wa.me/525548438403?text="+msg,"_blank");

  carrito=[];
  renderCarrito();
}
</script>

</body>
</html>
